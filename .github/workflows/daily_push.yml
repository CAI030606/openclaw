name: OpenClaw Daily Report

on:
  workflow_dispatch:
  schedule:
    - cron: '0 1 * * *'

jobs:
  daily_job:
    runs-on: ubuntu-latest
    steps:
      - name: Run AI Tasks
        env:
          OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
          SERVERCHAN_SENDKEY: ${{ secrets.SERVERCHAN_SENDKEY }}
        run: |
          python3 -c "
          import urllib.parse, urllib.request, json, os

          def get_ai_res(prompt):
              data = json.dumps({'model': 'deepseek-chat', 'messages': [{'role': 'user', 'content': prompt}]}).encode()
              req = urllib.request.Request('https://api.deepseek.com/chat/completions', data=data, headers={'Content-Type': 'application/json', 'Authorization': f'Bearer {os.environ[\"OPENAI_API_KEY\"]}'})
              with urllib.request.urlopen(req) as f:
                  return json.loads(f.read().decode())['choices'][0]['message']['content']

          # 1. 维特根斯坦
          txt1 = get_ai_res('精选一句《维特根斯坦传》语录并简短解读，80字内。')

          # 2. 小红书深度情报 (加强了对标账号和逻辑拆解)
          prompt_xhs = '''
          作为资深小红书运营专家，请提供3个今日最值得关注的爆款案例分析：
          1. 趋势方向：一句话总结。
          2. 模拟爆文标题：给出一个万赞级别的参考标题。
          3. 建议对标账号：提供3个该领域知名的账号名，方便我搜索学习。
          4. 爆点拆解：为什么火？(视觉/情绪/痛点)。
          字数180字内，排版美观。
          '''
          txt2 = get_ai_res(prompt_xhs)

          # 发送
          msg = f'【维特根斯坦】\n{txt1}\n\n【小红书深度情报】\n{txt2}'
          params = urllib.parse.urlencode({'title': '早安·深度简报', 'desp': msg})
          urllib.request.urlopen(f'https://sctapi.ftqq.com/{os.environ[\"SERVERCHAN_SENDKEY\"]}.send?{params}')
          "
