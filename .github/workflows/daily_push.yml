name: OpenClaw Daily Philosophy

on:
  workflow_dispatch:
  schedule:
    - cron: '0 1 * * *'

jobs:
  philosophy_push:
    runs-on: ubuntu-latest
    steps:
      - name: Ask AI and Send to WeChat
        env:
          OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
          SERVERCHAN_SENDKEY: ${{ secrets.SERVERCHAN_SENDKEY }}
        run: |
          # 1. 直接获取 AI 内容并存入临时文件，避免环境变量报错
          curl -s https://api.deepseek.com/chat/completions \
            -H "Content-Type: application/json" \
            -H "Authorization: Bearer $OPENAI_API_KEY" \
            -d '{
              "model": "deepseek-chat",
              "messages": [
                {"role": "system", "content": "你是一位哲学导师，擅长解读维特根斯坦。"},
                {"role": "user", "content": "请从《维特根斯坦传》中精选一句短语录，并简要解释其意义，总字数控制在100字以内。"}
              ]
            }' | jq -r '.choices[0].message.content' > ai_msg.txt

          # 2. 检查内容并处理换行，确保推送格式正确
          CONTENT=$(cat ai_msg.txt)
          echo "AI 生成内容为: $CONTENT"

          # 3. 使用 Python 进行安全的 URL 编码并发送，彻底解决特殊字符问题
          python3 -c "
import urllib.parse, urllib.request, os
content = open('ai_msg.txt').read()
sendkey = os.environ['SERVERCHAN_SENDKEY']
params = urllib.parse.urlencode({'title': '早安·维特根斯坦', 'desp': content})
url = f'https://sctapi.ftqq.com/{sendkey}.send?{params}'
urllib.request.urlopen(url)
          "
