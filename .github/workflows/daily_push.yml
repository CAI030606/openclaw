name: OpenClaw Daily Philosophy

on:
  workflow_dispatch: # 支持手动点击测试
  schedule:
    - cron: '0 1 * * *' # UTC 01:00 对应 北京时间 09:00

jobs:
  philosophy_push:
    runs-on: ubuntu-latest
    steps:
      - name: Ask AI for Wittgenstein Quote
        id: ai_logic
        env:
          # 使用你之前在 Secrets 存好的 DeepSeek Key
          OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
        run: |
          # 调用 DeepSeek API 获取语录
          RESPONSE=$(curl -s https://api.deepseek.com/chat/completions \
            -H "Content-Type: application/json" \
            -H "Authorization: Bearer $OPENAI_API_KEY" \
            -d '{
              "model": "deepseek-chat",
              "messages": [
                {"role": "system", "content": "你是一位全世界最优秀的哲学导师，擅长解读维特根斯坦。"},
                {"role": "user", "content": "请从《维特根斯坦传》中精选一句语录，并简要解释其哲学意义，字数在150字以内。"}
              ]
            }')
          
          # 提取 AI 返回的内容（去掉多余引号和转义符）
          CONTENT=$(echo $RESPONSE | jq -r '.choices[0].message.content')
          echo "AI_CONTENT=$CONTENT" >> $GITHUB_ENV

      - name: Send to WeChat via ServerChan
        env:
          SERVERCHAN_SENDKEY: ${{ secrets.SERVERCHAN_SENDKEY }}
        run: |
          # 将 AI 生成的内容推送到微信
          # 注意：对内容进行 URL 编码防止特殊字符导致推送失败
          ENCODED_CONTENT=$(python3 -c "import urllib.parse; print(urllib.parse.quote('''$AI_CONTENT'''))")
          curl -s "https://sctapi.ftqq.com/${{ env.SERVERCHAN_SENDKEY }}.send?title=早安·维特根斯坦&desp=$ENCODED_CONTENT"
