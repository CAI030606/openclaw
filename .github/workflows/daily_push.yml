name: OpenClaw Elite Intelligence (Calibrated)

on:
  workflow_dispatch:
  schedule:
    - cron: '10 1 * * *'   # ç›®æ ‡åŒ—äº¬æ—¶é—´ 09:10 (æ—©æŠ¥)
    - cron: '40 13 * * *'  # ç›®æ ‡åŒ—äº¬æ—¶é—´ 21:40 (æ™šæŠ¥)

jobs:
  daily_job:
    runs-on: ubuntu-latest
    steps:
      - name: Run AI Tasks
        env:
          OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
          SERVERCHAN_SENDKEY: ${{ secrets.SERVERCHAN_SENDKEY }}
        run: |
          python3 -c "
          import urllib.parse, urllib.request, json, os, datetime, re

          now_bj = datetime.datetime.utcnow() + datetime.timedelta(hours=8)
          date_str = now_bj.strftime('%m-%d')
          
          # æ ¸å¿ƒä¿®å¤ï¼šæ ¹æ® UTC è§¦å‘æ—¶é—´å¼ºåˆ¶åˆ†æµï¼Œä¸å†ä¾èµ–ä¸ç¨³å®šçš„å½“å‰å°æ—¶
          utc_hour = datetime.datetime.utcnow().hour
          is_morning = (0 <= utc_hour <= 5)

          def get_ai_res(prompt):
              data = json.dumps({'model': 'deepseek-chat', 'messages': [{'role': 'user', 'content': prompt}]}).encode()
              req = urllib.request.Request('https://api.deepseek.com/chat/completions', data=data, headers={'Content-Type': 'application/json', 'Authorization': 'Bearer ' + os.environ['OPENAI_API_KEY']})
              with urllib.request.urlopen(req) as f:
                  return json.loads(f.read().decode())['choices'][0]['message']['content']

          if is_morning:
              # --- æ—©å®‰ï¼šå“²å­¦ã€å°çº¢ä¹¦ä¸ AI å¤§äº‹è®° ---
              prompt = 'è¯·ç”Ÿæˆä»Šæ—¥ç®€æŠ¥ã€‚è¦æ±‚åŒ…å«ï¼š1.ã€ç»´ç‰¹æ ¹æ–¯å¦è¯­å½•åŠæ·±åº¦è§£è¯»ã€‘(300å­—)ï¼›2.ã€ä»Šæ—¥ AI å±Š 3 æ¡å¤§äº‹è®°æ±‡æ€»ã€‘ï¼›3.ã€5ä¸ªå°çº¢ä¹¦çˆ†æ¬¾æ‹†è§£ã€‘ã€‚æ’ç‰ˆè¦ç²¾ç¾ï¼Œå¤šç”¨ç¬¦å·å’ŒåŠ ç²—ã€‚'
              title = 'â˜€ï¸ æ—©å®‰Â·æ·±åº¦æƒ…æŠ¥ ' + date_str
              msg = get_ai_res(prompt)
          else:
              # --- æ™šå®‰ï¼šè´¢ç»æ±‡æ€»ä¸ä½•æ ¡é•¿å¼å†…å‚ ---
              raw_news = 'èµ„è®¯è·å–ä¸­...'
              try:
                  req = urllib.request.Request('https://top.baidu.com/board?tab=realtime', headers={'User-Agent': 'Mozilla/5.0'})
                  with urllib.request.urlopen(req) as r:
                      titles = re.findall(r'\"word\":\"(.*?)\"', r.read().decode())
                      raw_news = 'ã€'.join(titles[:25])
              except: pass

              prompt = 'ä½ ç°åœ¨æ˜¯é¦–å¸­åˆ†æå¸ˆã€‚è¯·é’ˆå¯¹çƒ­ç‚¹ [' + raw_news + '] æ’°å†™å†…å‚ã€‚æ¨¡å—éœ€åŒ…å«ï¼š1.ã€è´¢ç»æ ¸å¿ƒæ±‡æ€»ã€‘(å«å®è§‚ä¸è¡Œä¸šåŠ¨æ€)ï¼›2.ã€å›½é™…ä¸å›½å†…è¦é—»ã€‘ï¼›3.ã€ä»Šæ—¥å°ç»“ã€‘ã€‚å¹¶ä»¿ç…§ä½•æ ¡é•¿é£æ ¼ï¼Œç”Ÿæˆä¸€ä»½æœ¬å‘¨æ·±åº¦é˜…è¯»è¿›åº¦ âœ… è¡¨æ ¼ã€‚æ’ç‰ˆéœ€å†·å³»ã€ä¸“ä¸šï¼Œ500å­—ä»¥ä¸Šã€‚'
              title = 'ğŸŒ™ æ™šå®‰Â·é¦–å¸­å†…å‚ ' + date_str
              msg = get_ai_res(prompt)

          s_key = os.environ['SERVERCHAN_SENDKEY']
          params = urllib.parse.urlencode({'title': title, 'desp': msg})
          urllib.request.urlopen('https://sctapi.ftqq.com/' + s_key + '.send?' + params)
          "
