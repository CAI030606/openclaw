name: OpenClaw Elite Intelligence (Pure Edition)

on:
  workflow_dispatch:
  schedule:
    - cron: '10 1 * * *'   # æ—©ä¸Š 09:10
    - cron: '40 13 * * *'  # æ™šä¸Š 21:40

jobs:
  daily_job:
    runs-on: ubuntu-latest
    steps:
      - name: Run AI Tasks
        env:
          OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
          SERVERCHAN_SENDKEY: ${{ secrets.SERVERCHAN_SENDKEY }}
        run: |
          python3 -c "
          import urllib.parse, urllib.request, json, os, datetime, re

          now_bj = datetime.datetime.utcnow() + datetime.timedelta(hours=8)
          date_str = now_bj.strftime('%m-%d')
          utc_hour = datetime.datetime.utcnow().hour
          is_morning = (0 <= utc_hour <= 5)

          def get_ai_res(prompt):
              data = json.dumps({'model': 'deepseek-chat', 'messages': [{'role': 'user', 'content': prompt}]}).encode()
              req = urllib.request.Request('https://api.deepseek.com/chat/completions', data=data, headers={'Content-Type': 'application/json', 'Authorization': 'Bearer ' + os.environ['OPENAI_API_KEY']})
              with urllib.request.urlopen(req) as f:
                  return json.loads(f.read().decode())['choices'][0]['message']['content']

          if is_morning:
              # --- â˜€ï¸ æ—©å®‰ï¼šå›å½’ç¾æ„Ÿæ’ç‰ˆ ---
              prompt = 'è¯·ç”Ÿæˆä»Šæ—¥æ—©é—´ç®€æŠ¥ã€‚è¦æ±‚æ¨¡å—åŒ–æ’ç‰ˆï¼š\n' + \
                       '1. âœ¨ **ã€ç»´ç‰¹æ ¹æ–¯å¦ Â· å“²å­¦æ€è¾¨ã€‘** (300å­—æ·±åº¦è§£è¯»ï¼Œå¸¦ > å¼•ç”¨ç¬¦)\n' + \
                       '2. ğŸ¤– **ã€AI ç§‘æŠ€å‰å“¨ã€‘** (ä»Šæ—¥3æ¡å…¨çƒAIå¤§äº‹ä»¶ç²¾ç®€æ±‡æ€»)\n' + \
                       '3. ğŸ”¥ **ã€å°çº¢ä¹¦æµé‡å¯†ç ã€‘** (5ä¸ªçˆ†æ¬¾æ¡ˆä¾‹æ‹†è§£ï¼Œå¤šç”¨Emoji)\n' + \
                       'æ’ç‰ˆè¦ç²¾ç¾ï¼Œé‡ç‚¹å…³é”®è¯**åŠ ç²—**ã€‚'
              title = 'â˜€ï¸ æ—©å®‰Â·æ·±åº¦æƒ…æŠ¥ ' + date_str
              msg = get_ai_res(prompt)
          else:
              # --- ğŸŒ™ æ™šå®‰ï¼šé¦–å¸­å†…å‚ + è´¢ç» + è¿›åº¦è¡¨ ---
              raw_news = 'èµ„è®¯è·å–ä¸­...'
              try:
                  req = urllib.request.Request('https://top.baidu.com/board?tab=realtime', headers={'User-Agent': 'Mozilla/5.0'})
                  with urllib.request.urlopen(req) as r:
                      titles = re.findall(r'\"word\":\"(.*?)\"', r.read().decode())
                      raw_news = 'ã€'.join(titles[:25])
              except: pass

              prompt = 'ä½ ç°åœ¨æ˜¯é¦–å¸­æ”¿ç»åˆ†æå¸ˆã€‚è¯·é’ˆå¯¹çƒ­ç‚¹ [' + raw_news + '] æ’°å†™å†…å‚ã€‚æ¨¡å—éœ€åŒ…å«ï¼š\n' + \
                       '1. ğŸŒ **ã€å›½é™…åŠ¨æ€ã€‘** (æ·±åº¦å¤§å›½åšå¼ˆ)\n' + \
                       '2. ğŸ‡¨ğŸ‡³ **ã€å›½å†…è¦é—»ã€‘** (æ”¿ç­–ä¸ç»æµ)\n' + \
                       '3. ğŸ“ˆ **ã€è´¢ç»é£å‘æ ‡ã€‘** (é‡ç‚¹æ±‡æ€»ä»Šæ—¥è´¢ç»ã€è¡Œä¸šæ³¢åŠ¨)\n' + \
                       '4. ğŸ¯ **ã€çŸ¥è¯†å†…åŒ– Â· ç ”å­¦è¿›åº¦è¡¨ã€‘** (ç”Ÿæˆä¸€ä»½ Markdown è¿›åº¦è¡¨æ ¼ï¼Œå«åºå·ã€æ–‡ç« æ ‡é¢˜ã€æ·±åº¦åˆ†æã€é‡‘å¥ã€è¿›åº¦âœ…)\n' + \
                       '5. ğŸ­ **ã€AI å“²å­¦ç‚¹è¯„ã€‘** (äººæ–‡å…³æ€€æ”¶å°¾)ã€‚\n' + \
                       'æ³¨æ„ï¼šä¸¥ç¦å‡ºç°ä»»ä½•ç‰¹å®šäººç‰©å§“åã€‚æ’ç‰ˆè¦æ±‚æé«˜ï¼Œå¤šç”¨ç²—ä½“ï¼Œ500å­—ä»¥ä¸Šï¼Œå…·å¤‡ä¸“ä¸šå†…å‚è´¨æ„Ÿã€‚'
              title = 'ğŸŒ™ æ™šå®‰Â·é¦–å¸­å†…å‚ ' + date_str
              msg = get_ai_res(prompt)

          s_key = os.environ['SERVERCHAN_SENDKEY']
          params = urllib.parse.urlencode({'title': title, 'desp': msg})
          urllib.request.urlopen('https://sctapi.ftqq.com/' + s_key + '.send?' + params)
          "
